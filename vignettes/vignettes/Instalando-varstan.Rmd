---
title: "Instalando-varstan"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Instalando-varstan}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Introducción

Varstan es un paquete para analizar series de tiempo con modelos estructurales comunes como arima, garch, var, bekk, SVM, HMM, ETS y otros. En la esta version beta los modelos varbekk y varbekkm(1) estan actualmente disponibles.

La dinámica para utilizar el paquete es:
   
   + Crear la estructura del modelo mediante un constructor (*varbekk,varbekkm,var*)
   
   + Definir los parametros de las prioris
   
   + Llamar la funcion varstan para estimar los parametros del modelo en STAN.
   
   + Evaluar los resultados usando las funciones summary y point_estimate.
   

La distribución a posteriori se aproxima usando un Monte carlo Hamiltoneano, mediante el algoritmo NUTs implementado en el paquete en R **rstan**.

## Instalando Rstan en R

Para estar en el lado seguro, es muchas veces necesario remover algún rstan existente.

```{r,eval=FALSE}
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
```

Luego, re iniciar R, en la mayoria de los casos solo es correr el siguiente codigo

```{r,eval=FALSE}
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
```

Para mayor detalles revisar el siguiente enlace  [rstan](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started)

### Checking the C++ Toolchain

En RStudio (*preferiblemente*) o en R, correr una vez

```{r,eval=FALSE
pkgbuild::has_build_tools(debug = TRUE)
```

Para revisar si tu C++ toolchain usando el paquete pkgbuild que se instala al usar rstan funciona correctamente. Si el código regresa TRUE, entonce tu C++ toolchain esta propiamente instalado. Si la opcion **FALSE** aparece entonces leer la sección  **Checking the C++ Toolchain** en [rstan](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started)

### Troubleshooting Rstan / Rtools install for Windows:

Asegurarse que la version más reciente de R y Rtools está instalada.

Incluir la siguientes lineas en el archivo makevars en  home/.R/makevars. :

    CXX14 = g++ -std=c++1y
    CXX14FLAGS = -O3 -Wno-unused-variable -Wno-unused-function

Si el archivo makevars.R no existe en la carpeta .R, correr el siguiente codigo en la consola:

```{r,eval=FALSE}
dotR <- file.path(Sys.getenv("HOME"), ".R")
if (!file.exists(dotR)) dir.create(dotR)
M <- file.path(dotR, ifelse(.Platform$OS.type == "windows", "Makevars.win", "Makevars"))
if (!file.exists(M)){
  file.create(M) 
    cat("\nCXX14FLAGS=-O3 -march=native -mtune=native",
    if( grepl("^darwin", R.version$os)) "CXX14FLAGS += -arch x86_64 -ftemplate-depth-256" else 
     if (.Platform$OS.type == "windows") "CXX11FLAGS=-O3 -march=native -mtune=native" else "CXX14FLAGS += -fPIC",
     if (.Platform$OS.type == "windows") "CXX11FLAGS=-O3 -mtune=native CXX14 = $(BINPREF)g++ -m$(WIN) -std=c++1y" else "CXX14FLAGS += -fPIC",
     if (.Platform$OS.type == "windows") "CXX14 = g++ -std=c++1y" else "CXX14FLAGS += -fPIC",
     if (.Platform$OS.type == "windows") "CXX14FLAGS = -O3 -Wno-unused-variable -Wno-unused-function" else "CXX14FLAGS += -fPIC",
    file = M, sep = "\n", append = TRUE)
} 
rm(dotR,M)
```    

El archivo makevars.R en *C:\Users\Documents\.R* se muestra de la siguiente forma:

```{r,echo=FALSE}
cat("CXX14FLAGS=-O3 -march=native -mtune=native",
"CXX11FLAGS=-O3 -march=native -mtune=native",
"CXX11FLAGS=-O3 -mtune=native CXX14 = $(BINPREF)g++ -m$(WIN) -std=c++1y",
"CXX14 = g++ -std=c++1y",
"CXX14FLAGS = -O3 -Wno-unused-variable -Wno-unused-function",sep="\n")
```

Asegurarse que su archivo se mire similar al de arriba.

### Instalar  varstan desde git

Para evitar problemas al instalar el paquete, asegurarse haber actualizado los siguientes paquetes: **devtools,pkgbuild,remotes,StanHeaders,OpenMx**. Si no está seguro, ejecute la siguiente linea de código:

```{r,eval=FALSE}
packs <- c('devtools','pkgbuild','remotes','StanHeaders','OpenMx','rstantools')
install.packages(packs,dependencies = TRUE)
rm(packs)
```

Finalmente para instalar varstan desde git ejecutar el siguiente código:

```{r,eval=FALSE}
library(devtools)

remove.packages("varstan")
if (file.exists(".RData")) file.remove(".RData")

Sys.setenv(PATH = paste("C:/Rtools/bin", Sys.getenv("PATH"), sep=";"))
Sys.setenv(PATH = paste("C:\\Rtools\\mingw_64\\bin", Sys.getenv("PATH"), sep=";"))
Sys.setenv(BINPREF = "C:/Rtools/mingw_$(WIN)/bin/")

install_github("asael697/varstan", upgrade='never',INSTALL_opts = "--no-multiarch", dependencies = c("Depends", "Imports"))
```


 
